\documentclass[11pt,a4paper]{article}
\usepackage[a4paper, margin=0.8in]{geometry}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{natbib}
\usepackage{wrapfig}
\usepackage{graphicx}
\usepackage{url}
\usepackage{pgf}
\usepackage{subcaption}

\makeatletter
\def\@maketitle{%
	\newpage
	\null
	\vskip 2em%
	\begin{center}%
		\let \footnote \thanks
		{\LARGE \@title \par}%
		\vskip 1em%
		{\Large Fast Iterative Solvers, Project 2\par}%
		\vskip 1.5em%
		{\large
			\lineskip .5em%
			\begin{tabular}[t]{c}%
				\@author
			\end{tabular}\par}%
		\vskip 1em%
		{\large \@date}%
	\end{center}%
	\par
	\vskip 1.5em}
\makeatother

\title{Multigrid Method}
\author{Johannes Leonard Grafen, 380149}
\makeindex

%new commands
\newcommand{\refFig}[1]{Fig. \ref{#1}}
\newcommand{\refEq}[1]{Eq. (\ref{#1})}
\newcommand{\refTab}[1]{Tab. \ref{#1}}

%hyperref stuff ----------------------------------------------------------------------------------------------------------------------------------------------
\ifpdf
	\usepackage[ plainpages = false, pdfpagelabels, 
	%                 pdfpagelayout = useoutlines,
	bookmarks,
	bookmarksopen = true,
	bookmarksnumbered = true,
	breaklinks = true,
	linktocpage,
	colorlinks = false,  % was true
	linkcolor = blue,
	urlcolor  = blue,
	citecolor = blue,
	anchorcolor = blue,
	hyperindex = true,
	hyperfigures
	]{hyperref} 
	
	\DeclareGraphicsExtensions{.png, .jpg, .jpeg, .pdf, .gif} %GIF doesn't work??
	\usepackage{graphicx}
	\pdfcompresslevel=9
	\graphicspath{{0_frontmatter/figures/PNG/}{0_frontmatter/figures/PDF/}{0_frontmatter/figures/}}
\else
	\usepackage[ dvips, 
	plainpages = false, 
	pdfpagelabels, 
	bookmarksnumbered = true,
	breaklinks = true,
	linktocpage,
	colorlinks = false,
	linkcolor = blue,
	urlcolor  = blue,
	citecolor = blue,
	anchorcolor = white,
	hyperindex = false,
	]{hyperref}
	
	\DeclareGraphicsExtensions{.eps, .ps}
	\usepackage{epsfig}
	\usepackage{graphicx}
	\graphicspath{{0_frontmatter/figures/EPS/}{0_frontmatter/figures/}}
\fi

\ifpdf  
\hypersetup{pdfauthor={Johannes Leonard Grafen},%
	pdftitle={Fast Iterative Solvers, Project 2},%
}
\fi
%------------------------------------------------------------------------------------------------------------------------------------------------------------

\begin{document}
\renewcommand\baselinestretch{1.0}
\baselineskip=18pt plus1pt	

\pagenumbering{gobble}
\maketitle
\newpage
\pagenumbering{arabic}
\tableofcontents
\listoffigures	% print list of figures
%\listoftables  % print list of tables
\newpage

\section{Remarks on used architecture and compiler options}
The code was written in C++, compiled using the Clang compiler and executed on an Apple Silicon M1 Pro Chip featuring the ARM64 architecture. To measure timings, the high resolution clock of the std chrono library was employed. The following flags where passed to the compiler to enhance code performance of the aforementioned architecture: -march=native, -O2. 

\section{Multigrid Method - MG}
\label{chapter:MG}
For the Multigrid iterations, W-cycles ($\gamma = 2$) were used. An iteration was considered as converged with the criterion 
\begin{equation}
	\frac{|| r^{(m)}||_{\infty}}{|| r^{(0)}||_{\infty}} < 10^{-10} ,
\end{equation}
were $r^{(m)}$ denotes the residual of the $m$-th iteration and $r^{(0)}$ the initial residual using $\mathbf{u} = \mathbf{0}$ as an initial guess for the solution vector.

\subsection{Validation of MG Method}
The solution obtained by the multigrid method is compared to the exact solution $\mathbf{U}_{ex}(x,y) = sin(2\pi x)sin(2 \pi y)$ in \refFig{fig::Val4} for $n=4$ and in \refFig{fig::Val7} for $n=7$. The estimated solution is in good agreement with the exact solution, the max error for $n=4$ is $\max_{i,j} e_{i,j} = 1.295 \cdot 10^{-2}$ and for $n=7$ the max error measures $\max_{i,j} e_{i,j} = 2.01 \cdot 10^{-4}$. 
%
\begin{figure}[h!]
	\centering
	\begin{subfigure}[h!]{.3\textwidth}
			\centering
			\resizebox{0.4\width}{!}{\input{plots/u_ex_mg_4.pgf}}
			\caption{$\mathbf{U}_{ex}$}
			\label{fig::Uex4}
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.3\textwidth}
		\centering
		\resizebox{0.4\width}{!}{\input{plots/u_est_mg_4.pgf}}
		\caption{$\mathbf{U}_{est}$}
		\label{fig::Uest4}
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.3\textwidth}
		\centering
		\resizebox{0.4\width}{!}{\input{plots/error_4.pgf}}
		\caption{Error $\mathbf{e} = |\mathbf{U}_{ex} - \mathbf{U}_{est}|$}
		\label{fig::Error4}
	\end{subfigure}
	\label{fig::Val4}
	\caption{Plots of exact solution, approximated solution and corresponding error for $n=4$ }
	\label{fig::Val4}
\end{figure}
%
\begin{figure}[h!]
	\centering
	\begin{subfigure}[h!]{.3\textwidth}
		\centering
		\resizebox{0.4\width}{!}{\input{plots/u_ex_mg_7.pgf}}
		\caption{$\mathbf{U}_{ex}$}
		\label{fig::Uex7}
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.3\textwidth}
		\centering
		\resizebox{0.4\width}{!}{\input{plots/u_est_mg_7.pgf}}
		\caption{$\mathbf{U}_{est}$}
		\label{fig::Uest7}
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.3\textwidth}
		\centering
		\resizebox{0.4\width}{!}{\input{plots/error_7.pgf}}
		\caption{Error $\mathbf{e} = |\mathbf{U}_{ex} - \mathbf{U}_{est}|$}
		\label{fig::Error7}
	\end{subfigure}
	\caption{Plots of exact solution, approximated solution and corresponding error for $n=7$ }
	\label{fig::Val7}
\end{figure}
%

\subsection{Convergence Plots}

\begin{figure}[h!]
	\centering
	\begin{subfigure}[h!]{.49\textwidth}
		\begin{center}
			\resizebox{0.52\width}{!}{\input{plots/ResidualPlot_nu1_1.pgf}}
			\caption{$\nu_1 = \nu_2 = 1$}
			\label{fig::Res1}
		\end{center}	
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.49\textwidth}
		\centering
		\resizebox{0.52\width}{!}{\input{plots/ResidualPlot_nu1_2.pgf}}
		\caption{$\nu_1 = 2,  \nu_2 = 1$}
		\label{fig::Res2}
	\end{subfigure}
	\label{fig::Res}
	\caption{Convergence against multigrid iterations $m$ for meshes $n=4$ and $n=7$ }
\end{figure}

\subsection{Convergence for different $\nu_1$}

\begin{figure}[h!]
	\centering
	\begin{subfigure}[h!]{.49\textwidth}
		\begin{center}
			\resizebox{0.52\width}{!}{\input{plots/Timings_NU_4.pgf}}
			\caption{$n=4$}
			\label{fig::TimNu1}
		\end{center}	
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.49\textwidth}
		\centering
		\resizebox{0.52\width}{!}{\input{plots/Timings_NU_7.pgf}}
		\caption{$n=7$}
		\label{fig::TimNu2}
	\end{subfigure}
	\label{fig::TimNu}
	\caption{Runtime against number of smoothing iterations $\nu_1 = 1...50 $ for meshes $n=4$ and $n=7$ }
\end{figure}

%\subsection{Convergence for different $\nu2$}

\subsection{Convergence for different $\gamma$}

\begin{figure}[h!]
	\centering
	\begin{subfigure}[h!]{.49\textwidth}
		\begin{center}
			\resizebox{0.52\width}{!}{\input{plots/Timings_GAMMA_4.pgf}}
			\caption{$n=4$}
			\label{fig::TimGamma1}
		\end{center}	
	\end{subfigure}
	\hfill
	\begin{subfigure}[h!]{.49\textwidth}
		\centering
		\resizebox{0.52\width}{!}{\input{plots/Timings_GAMMA_7.pgf}}
		\caption{$n=7$}
		\label{fig::TimGamma2}
	\end{subfigure}
	\label{fig::TimGamma}
	\caption{Runtime against number of $\gamma$-cycles for $\gamma = 1...10 $ for meshes $n=4$ and $n=7$ }
\end{figure}




%
%\begin{figure}[!htbp]
%	\centering
%	\hspace*{0.8cm}
%	\leavevmode
%	\resizebox{0.82\width}{!}{\input{pgf/relResiduals.pgf}}
%	\caption{Comparison of the different preconditioning options for the GMRES procedure to the full GMRES Method without preconditioning using m = 600 Krylov vectors as an input.}
%	\label{fig::Residuals}
%\end{figure}
%


\end{document}